<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Deno Chat</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/ui@latest/dist/tailwind-ui.min.css">
  </head>
  <body class="antialiased font-sans bg-gray-200">
    <div id="app"></div>

    <script type="module">
      import Vue from 'https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.esm.browser.js'

      new Vue({
        el: '#app',
        data () {
          return {
            ws: null,
            messages: [],
            message: '',
          }
        },
        template: `<div class="max-w-3xl mx-auto py-12 sm:px-6 lg:px-8">
          <div class="bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 border-b border-gray-200 sm:px-6">
              <h3 class="text-lg leading-6 font-medium text-gray-900">
                  Deno Chat
              </h3>
            </div>
            <div class="px-4 py-5 sm:p-6">
              <div class="mt-2 max-w-xl text-sm leading-5 text-gray-500">
                <div v-for="(message, index) in messages" :key="index">
                  <p>{{ message }}</p>
                </div>
              </div>
              <div class="mt-5">
                <form @submit.prevent="submit" class="flex justify-between items-center">
                  <div class="relative rounded-md shadow-sm flex-grow">
                    <input id="email" v-model="message" class="form-input block w-full sm:text-sm sm:leading-5" placeholder="Text message">
                  </div>

                  <span class="mt-3 inline-flex rounded-md shadow-sm sm:mt-0 sm:ml-3 sm:w-auto">
                    <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150 sm:w-auto sm:text-sm sm:leading-5">
                      Send Message
                    </button>
                  </span>
                </form>

                <div class="px-4 py-5 border-t border-gray-200 sm:px-6">
                  <nav class="flex justify-between items-center space-x-2">
                    <a href="/general" class="px-3 py-2 flex-grow text-center text-sm leading-5 font-medium text-gray-900 rounded-md bg-gray-100 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:bg-gray-200 transition ease-in-out duration-150" aria-current="page">
                      General
                    </a>
                    <a href="/random" class="px-3 py-2 flex-grow text-center text-sm leading-5 font-medium text-gray-600 rounded-md hover:text-gray-900 hover:bg-gray-50 focus:outline-none focus:text-gray-900 focus:bg-gray-50 transition ease-in-out duration-150">
                      Random
                    </a>
                    <a href="/deno" class="px-3 py-2 flex-grow text-center text-sm leading-5 font-medium text-gray-600 rounded-md hover:text-gray-900 hover:bg-gray-50 focus:outline-none focus:text-gray-900 focus:bg-gray-50 transition ease-in-out duration-150">
                      Deno
                    </a>
                    <a href="/typescript" class="px-3 py-2 flex-grow text-center text-sm leading-5 font-medium text-gray-600 rounded-md hover:text-gray-900 hover:bg-gray-50 focus:outline-none focus:text-gray-900 focus:bg-gray-50 transition ease-in-out duration-150">
                      TypeScript
                    </a>
                    <a href="/javascript" class="px-3 py-2 flex-grow text-center text-sm leading-5 font-medium text-gray-600 rounded-md hover:text-gray-900 hover:bg-gray-50 focus:outline-none focus:text-gray-900 focus:bg-gray-50 transition ease-in-out duration-150">
                      JavaScript
                    </a>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>`,
        created () {
          if (this.ws) this.ws.close()
          this.ws = new WebSocket(`ws://${window.location.host}/ws`)
          this.ws.addEventListener('message', ({Â data }) => {
            this.messages = [...this.messages, data]
          })
        },
        methods: {
          submit (e) {
            this.ws.send(this.message)
            this.message = ''
          }
        }
      })
    </script>
  </body>
</html>
